<div class="register-container">
  <h1 class="register-title">Regístrate</h1>
  
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form" *ngIf="!showVerification">
    <!-- Nombre -->
    <div class="form-group">
      <label for="nombre">Nombre</label>
      <input 
        type="text" 
        id="nombre" 
        formControlName="nombre" 
        placeholder="Ingresa tu nombre"
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched}"
      >
      <div *ngIf="registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched" class="error-message">
        Nombre es requerido
      </div>
    </div>

    <!-- Nombre de Usuario -->
    <div class="form-group">
      <label for="username">Nombre Usuario</label>
      <input 
        type="text" 
        id="username" 
        formControlName="username" 
        placeholder="Ingresa tu nombre de usuario"
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('username')?.invalid && registerForm.get('username')?.touched}"
      >
      <div *ngIf="registerForm.get('username')?.invalid && registerForm.get('username')?.touched" class="error-message">
        Nombre de usuario es requerido
      </div>
    </div>

    <!-- Correo -->
    <div class="form-group">
      <label for="correo">Correo</label>
      <input 
        type="email" 
        id="correo" 
        formControlName="correo" 
        placeholder="Ingresa tu correo"
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('correo')?.invalid && registerForm.get('correo')?.touched}"
      >
      <div *ngIf="registerForm.get('correo')?.invalid && registerForm.get('correo')?.touched" class="error-message">
        {{ registerForm.get('correo')?.errors?.['required'] ? 'Correo es requerido' : 'Ingresa un correo válido' }}
      </div>
    </div>

    <!-- Teléfono -->
    <div class="form-group">
      <label for="telefono">Teléfono</label>
      <input 
        type="tel" 
        id="telefono" 
        formControlName="telefono" 
        placeholder="Ingresa tu teléfono"
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('telefono')?.invalid && registerForm.get('telefono')?.touched}"
      >
      <div *ngIf="registerForm.get('telefono')?.invalid && registerForm.get('telefono')?.touched" class="error-message">
        {{ registerForm.get('telefono')?.errors?.['required'] ? 'Teléfono es requerido' : 'Debe tener 10 dígitos' }}
      </div>
    </div>

    <!-- Contraseña -->
    <div class="form-group">
      <label for="password">Contraseña</label>
      <input 
        type="password" 
        id="password" 
        formControlName="password" 
        placeholder="Ingresa tu contraseña"
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('password')?.invalid && registerForm.get('password')?.touched}"
      >
      <div *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched" class="error-message">
        {{ registerForm.get('password')?.errors?.['required'] ? 'Contraseña es requerida' : 'Mínimo 6 caracteres' }}
      </div>
    </div>

    <!-- Confirmar Contraseña -->
    <div class="form-group">
      <label for="confirmPassword">Confirma Contraseña</label>
      <input 
        type="password" 
        id="confirmPassword" 
        formControlName="confirmPassword" 
        placeholder="Confirma tu contraseña"
        class="form-input"
        [ngClass]="{'invalid': registerForm.hasError('notSame') && registerForm.get('confirmPassword')?.touched}"
      >
      <div *ngIf="registerForm.hasError('notSame') && registerForm.get('confirmPassword')?.touched" class="error-message">
        Las contraseñas no coinciden
      </div>
    </div>

    <!-- Ciudad -->
    <div class="form-group">
      <label for="ciudad">Ciudad</label>
      <select 
        id="ciudad" 
        formControlName="ciudad" 
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('ciudad')?.invalid && registerForm.get('ciudad')?.touched}"
      >
        <option value="" disabled selected>Selecciona la Ciudad</option>
        <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
      </select>
      <div *ngIf="registerForm.get('ciudad')?.invalid && registerForm.get('ciudad')?.touched" class="error-message">
        Selecciona una ciudad
      </div>
    </div>

    <!-- Dirección -->
    <div class="form-group">
      <label for="direccion">Dirección</label>
      <input 
        type="text" 
        id="direccion" 
        formControlName="direccion" 
        placeholder="Ingresa tu dirección"
        class="form-input"
        [ngClass]="{'invalid': registerForm.get('direccion')?.invalid && registerForm.get('direccion')?.touched}"
      >
      <div *ngIf="registerForm.get('direccion')?.invalid && registerForm.get('direccion')?.touched" class="error-message">
        Dirección es requerida
      </div>
    </div>

    <!-- Tipo de Usuario (oculto) -->
    <input type="hidden" formControlName="tipoUsuario">

    <button type="submit" class="submit-button" [disabled]="registerForm.invalid || loading">
      {{ loading ? 'Registrando...' : 'Registrarme' }}
    </button>
  </form>

  <!-- Sección de verificación -->
  <div *ngIf="showVerification" class="verification-section">
    <h2>Verificación de Correo</h2>
    <p>Hemos enviado un código de verificación a <strong>{{ registerForm.get('correo')?.value }}</strong>.</p>
    <p>Por favor ingresa el código recibido:</p>
    
    <div class="form-group">
      <input 
        type="text" 
        [(ngModel)]="verificationCode" 
        placeholder="Código de verificación"
        class="form-input"
      >
    </div>
    
    <button (click)="verifyAccount()" class="submit-button" [disabled]="!verificationCode">
      Verificar Cuenta
    </button>
    
    <button (click)="showVerification = false" class="secondary-button">
      Volver al formulario
    </button>
  </div>

  <div class="login-link">
    ¿Ya tienes una cuenta? <a routerLink="/login">Inicia sesión</a>
  </div>
  
  <p-toast position="top-center"></p-toast>
</div>